<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE>VFSX</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.1.2  (Win32)">
	<META NAME="AUTHOR" CONTENT="Steven R. Farley">
	<META NAME="CREATED" CONTENT="20040703;6224265">
	<META NAME="CHANGEDBY" CONTENT="Steven Farley">
	<META NAME="CHANGED" CONTENT="20040723;7433886">
	<STYLE>
	<!--
		@page { size: 8.5in 11in }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<P><FONT SIZE=4 STYLE="font-size: 16pt"><B>VFSX</B> &ndash; Samba VFS
External Bridge<BR><FONT SIZE=4>Version 0.1</FONT></FONT></P>
<P><FONT SIZE=4><B>Overview</B></FONT></P>
<P>VFSX is a transparent Samba Virtual File System (VFS) module which
forwards operations to a process on the same machine for handing
outside of the Samba daemon process (smbd). The external handler can
be implemented in any language with support for Unix domain sockets
(Python, Ruby, Perl, Java with Jtux) which is how VFSX and its
external process communicates.</P>
<P>The advantage of using VFSX over a pure VFS module is that any
programming language can be used to implement the transparent
operations. VFS modules linked directly into the Samba daemon must be
written in C or C++. while VFSX lets the developer implement a
transparent module in his favorite higher-level language, with all
the advantages of that language, outside of the smbd process.</P>
<P>The following figure illustrates a typical file server
configuration with VFSX:</P>
<P><IMG SRC="config.png" NAME="Figure 1" ALIGN=BOTTOM WIDTH=590 HEIGHT=216 BORDER=0></P>
<P>For Samba shares configured with VFSX as a VFS module, all client
requests to manipulate files and directories will first be sent to
the external handler process. For every VFS operation invoked by the
Samba daemon, VFSX sends to the handler the name of the operation,
the local directory path of the shared SMB service, the ID of the
calling user, and any additional arguments required for the
operation. The handler may respond to any operation for which it is
designed. Note that since VFSX is a transparent module, file contents
may not be passed between the VFSX module and its handler; The Samba
daemon must still handle the file system I/O directly. However, the
external handler may choose to reject an operation and return an
error code which will be passed on to the client.</P>
<P>Included with VFSX is an external handler written in Python.
Developers can extend this implementation to provide custom operation
handling.</P>
<P><FONT SIZE=4><B>Deploying the VFSX Module</B></FONT></P>
<P>VFSX requires Samba 3.0 or higher. All directory and file paths
described in the following instructions are based on Fedora Core 2 so
be sure to substitute paths as appropriate for your Linux
distribution.</P>
<OL>
	<LI><P>Install Samba 3.0, including the source distribution.</P>
	<LI><P>Download and expand the VFSX source distribution file:
	<FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">vfsx-0.1.tar.gz</FONT></FONT>.</P>
	<LI><P>Edit <FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">vfsx-0.1</FONT></FONT>/<FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">module/Makefile</FONT></FONT>
	and modify the <FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">SAMBA_SOURCE</FONT></FONT>
	variable to point to your Samba source directory.</P>
	<LI><P>Build the VFSX shared library: <FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">make</FONT></FONT></P>
	<LI><P>Attach VFSX to a Samba shared directory by adding the VFSX
	module name to the share's configuration parameters (found in
	<FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">/etc/samba/smb.conf</FONT></FONT>).
	For example:<BR><FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">[myshare]<BR>comment
	= VFSX-Aware Shared Directory<BR>path = /home/myuser/shared/<BR>valid
	users = myuser<BR>read only = No<BR>vfs objects = vfsx</FONT></FONT></P>
	<LI><P>Deploy the VFSX shared library (as root):<BR><FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">cp
	vfsx-0.1/module/vfsx.so /usr/lib/samba/vfs/</FONT></FONT></P>
	<LI><P>Restart Samba (as root):<BR><FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">/etc/rc.d/init.d/smb
	restart</FONT></FONT></P>
	<LI><P>Run the Python external event handler:<BR><FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">python
	vfsx-0.1/python/vfsx.py</FONT></FONT></P>
	<LI><P><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Access the
	share using smbclient or from a Windows system.  By default the
	Python handler prints debug activity messages to the console.  If
	the module has problems communicating with the external handler,
	error messages are written to syslog.</FONT></FONT></P>
</OL>
<P><FONT SIZE=4><B>Developing a Custom VFSX Handler with Python</B></FONT></P>
<OL>
	<LI><P>Extend</P>
	<LI><P>Run</P>
</OL>
<P><FONT SIZE=4><B>Links</B></FONT></P>
<UL>
	<LI><P><A HREF="http://sourceforge.net/projects/vfsx/">VFSX Project
	Page at SourceForge</A></P>
	<LI><P><A HREF="http://www.samba.org/">Samba Home Page</A></P>
	<LI><P><A HREF="http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/VFS.html">Samba
	VFS Module Configuration</A></P>
	<LI><P><A HREF="http://www.samba.org/samba/devel/docs/html/Samba-Developers-Guide.html#vfs">Samba
	VFS Module Developers Guide</A></P>
	<LI><P><A HREF="http://www.python.org/">Python Home Page</A></P>
</UL>
<P><FONT SIZE=4><B>License</B></FONT></P>
<P>VFSX is distributed under the open source <A HREF="http://opensource.org/licenses/cpl.php">Common
Public License</A>.  The file <FONT SIZE=2 STYLE="font-size: 11pt"><FONT FACE="Courier New, monospace">vfsx-0.1/LICENSE</FONT></FONT>
contains the license terms.</P>
<P>Copyright (C) 2004 Steven R. Farley.  All rights reserved.</P>
</BODY>
</HTML>